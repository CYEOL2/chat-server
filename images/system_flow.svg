<svg viewBox="0 0 1400 700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- 오른쪽을 향하는 화살표 -->
    <marker id="arrow-right" markerWidth="10" markerHeight="7" refX="8" refY="3.5" orient="auto" fill="#666">
      <polygon points="0 0, 10 3.5, 0 7"/>
    </marker>
    <!-- 왼쪽을 향하는 화살표 -->
    <marker id="arrow-left" markerWidth="10" markerHeight="7" refX="2" refY="3.5" orient="auto" fill="#666">
      <polygon points="10 0, 0 3.5, 10 7"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1400" height="700" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" font-size="28" font-weight="bold" fill="#333">Chat-Server (Spring WebFlux)</text>
  
  <!-- Main Container -->
  <rect x="30" y="80" width="1340" height="580" fill="#fff3e0" stroke="#f57c00" stroke-width="3" rx="15"/>
  
  <!-- Layer 1: Spring Framework -->
  <g id="spring-framework">
    <rect x="60" y="120" width="220" height="400" fill="#e8f5e9" stroke="#388e3c" stroke-width="2" rx="10"/>
    <text x="170" y="150" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">Spring Framework</text>
    
    <!-- DispatcherHandler -->
    <rect x="80" y="180" width="180" height="60" fill="#c8e6c9" stroke="#43a047" stroke-width="2" rx="5"/>
    <text x="170" y="215" text-anchor="middle" font-size="14" fill="#333">DispatcherHandler</text>
    
    <!-- SimpleUriHandlerMapping -->
    <rect x="80" y="435" width="180" height="60" fill="#c8e6c9" stroke="#43a047" stroke-width="2" rx="5"/>
    <text x="170" y="455" text-anchor="middle" font-size="14" fill="#333">SimpleUri</text>
    <text x="170" y="475" text-anchor="middle" font-size="14" fill="#333">HandlerMapping</text>
  </g>
  
  <!-- Layer 2: RouterFunction -->
  <g id="router">
    <rect x="320" y="185" width="160" height="60" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="10"/>
    <text x="400" y="210" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">Router</text>
    <text x="400" y="230" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">Function</text>
  </g>
  
  <!-- Layer 3: Functional Endpoint -->
  <g id="handlers">
    <rect x="520" y="120" width="220" height="400" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="10"/>
    <text x="630" y="150" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">Functional Endpoint</text>
    
    <!-- ChatHandler -->
    <rect x="540" y="180" width="180" height="60" fill="#bbdefb" stroke="#1e88e5" stroke-width="2" rx="5"/>
    <text x="630" y="215" text-anchor="middle" font-size="14" fill="#333">ChatHandler</text>
    
    <!-- WebClientHandler -->
    <rect x="540" y="260" width="180" height="60" fill="#bbdefb" stroke="#1e88e5" stroke-width="2" rx="5"/>
    <text x="630" y="295" text-anchor="middle" font-size="14" fill="#333">WebClientHandler</text>
    
    <!-- SSEHandler -->
    <rect x="540" y="340" width="180" height="60" fill="#bbdefb" stroke="#1e88e5" stroke-width="2" rx="5"/>
    <text x="630" y="375" text-anchor="middle" font-size="14" fill="#333">SSEHandler</text>
    
    <!-- WebSocketHandler -->
    <rect x="540" y="420" width="180" height="80" fill="#bbdefb" stroke="#1e88e5" stroke-width="2" rx="5"/>
    <text x="630" y="465" text-anchor="middle" font-size="14" fill="#333">WebSocketHandler</text>
  </g>
  
  <!-- Layer 4: Service -->
  <g id="service">
    <rect x="780" y="120" width="220" height="400" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="10"/>
    <text x="890" y="150" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">Service</text>
    
    <!-- ChatService -->
    <rect x="800" y="180" width="180" height="60" fill="#e1bee7" stroke="#8e24aa" stroke-width="2" rx="5"/>
    <text x="890" y="215" text-anchor="middle" font-size="14" fill="#333">ChatService</text>
    
    <!-- WebClientService -->
    <rect x="800" y="260" width="180" height="60" fill="#e1bee7" stroke="#8e24aa" stroke-width="2" rx="5"/>
    <text x="890" y="295" text-anchor="middle" font-size="14" fill="#333">WebClientService</text>
    
    <!-- NotificationService -->
    <rect x="800" y="360" width="180" height="120" fill="#e1bee7" stroke="#8e24aa" stroke-width="2" rx="5"/>
    <text x="890" y="420" text-anchor="middle" font-size="14" fill="#333">NotificationService</text>
  </g>
  
  <!-- Layer 5: Repository -->
  <g id="repository">
    <rect x="1040" y="120" width="220" height="180" fill="#ffebee" stroke="#d32f2f" stroke-width="2" rx="10"/>
    <text x="1150" y="150" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">Repository</text>
    
    <!-- ReactiveCrudRepository -->
    <rect x="1060" y="185" width="180" height="60" fill="#ffcdd2" stroke="#e53935" stroke-width="2" rx="5"/>
    <text x="1150" y="205" text-anchor="middle" font-size="14" fill="#333">ReactiveCrud</text>
    <text x="1150" y="225" text-anchor="middle" font-size="14" fill="#333">Repository</text>
  </g>
  
  <!-- External Components -->
  <!-- PostgreSQL DB -->
  <g id="database">
    <ellipse cx="1150" cy="380" rx="80" ry="40" fill="#e0f2f1" stroke="#00796b" stroke-width="3"/>
    <text x="1150" y="375" text-anchor="middle" font-size="16" font-weight="bold" fill="#333">PostgreSQL</text>
    <text x="1150" y="395" text-anchor="middle" font-size="14" fill="#333">Database</text>
  </g>
  
  <!-- External System -->
  <g id="external">
    <rect x="1060" y="460" width="180" height="60" fill="#e0e0e0" stroke="#616161" stroke-width="2" rx="5"/>
    <text x="1150" y="485" text-anchor="middle" font-size="14" fill="#333">External</text>
    <text x="1150" y="505" text-anchor="middle" font-size="14" fill="#333">System</text>
  </g>
  
  <!-- Connection Lines -->
  <!-- DispatcherHandler to RouterFunction -->
  <line x1="260" y1="215" x2="320" y2="215" stroke="#666" stroke-width="2"/>
  
  <!-- DispatcherHandler to SimpleUriHandlerMapping -->
  <line x1="170" y1="240" x2="170" y2="435" stroke="#666" stroke-width="2"/>
  
  <!-- SimpleUriHandlerMapping to WebSocketHandler -->
  <line x1="260" y1="465" x2="540" y2="465" stroke="#666" stroke-width="2"/>
  
  <!-- RouterFunction to Handlers -->
  <line x1="480" y1="215" x2="540" y2="215" stroke="#666" stroke-width="2"/>
  <line x1="480" y1="215" x2="540" y2="295" stroke="#666" stroke-width="2"/>
  <line x1="480" y1="215" x2="540" y2="375" stroke="#666" stroke-width="2" marker-start="url(#arrow-left)" marker-end="url(#arrow-right)"/>
  
  <!-- Handlers to Services -->
  <line x1="720" y1="215" x2="800" y2="215" stroke="#666" stroke-width="2"/>
  <line x1="720" y1="295" x2="800" y2="295" stroke="#666" stroke-width="2"/>
  <line x1="720" y1="460" x2="800" y2="215" stroke="#666" stroke-width="2"/>
  <!-- SSEHandler to NotificationService (Horizontal) -->
  <line x1="720" y1="380" x2="800" y2="380" stroke="#666" stroke-width="2"/>
  <!-- WebSocketHandler to NotificationService (Horizontal) -->
  <line x1="720" y1="450" x2="800" y2="450" stroke="#666" stroke-width="2"/>

  <!-- ChatService to ReactiveCrudRepository -->
  <line x1="980" y1="215" x2="1060" y2="215" stroke="#666" stroke-width="2"/>
  
  <!-- Repository to Database -->
  <line x1="1150" y1="245" x2="1150" y2="340" stroke="#666" stroke-width="2"/>
  
  <!-- WebClientService to External System -->
  <line x1="980" y1="295" x2="1020" y2="295" stroke="#666" stroke-width="2"/>
  <line x1="1020" y1="295" x2="1020" y2="490" stroke="#666" stroke-width="2"/>
  <line x1="1020" y1="490" x2="1060" y2="490" stroke="#666" stroke-width="2"/>
  
  <!-- Legend -->
  <g id="legend" transform="translate(60, 580)">
    <text x="0" y="20" font-size="16" font-weight="bold" fill="#333">아키텍처 구성:</text>
    <rect x="0" y="30" width="20" height="15" fill="#e8f5e9" stroke="#388e3c"/>
    <text x="25" y="42" font-size="13" fill="#555">Spring Framework - 핵심 프레임워크</text>
    
    <rect x="300" y="30" width="20" height="15" fill="#e3f2fd" stroke="#1976d2"/>
    <text x="325" y="42" font-size="13" fill="#555">Router/Handler - 요청 처리</text>
    
    <rect x="600" y="30" width="20" height="15" fill="#f3e5f5" stroke="#7b1fa2"/>
    <text x="625" y="42" font-size="13" fill="#555">Service - 비즈니스 로직</text>
    
    <rect x="900" y="30" width="20" height="15" fill="#ffebee" stroke="#d32f2f"/>
    <text x="925" y="42" font-size="13" fill="#555">Repository - 데이터 접근</text>
  </g>
  
  <!-- Note for data flow -->
  <text x="700" y="685" text-anchor="middle" font-size="12" font-style="italic" fill="#666">화살표가 없는 선은 왼쪽에서 오른쪽으로의 데이터 흐름을 의미합니다.</text>
</svg>